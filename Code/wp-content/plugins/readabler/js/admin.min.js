/*! License information can be found in admin.js.LICENSE.txt */
(()=>{"use strict";function e(e,n=1){const a=document.querySelector(e);a&&(t(a,n),a.addEventListener("change",(()=>{t(a,n)})))}function t(e,t){const n=e.closest("tr");if(null===n)return;let a=n;for(let n=0;n<t;n++)a=a.nextElementSibling,a.style.display=e.checked?"table-row":"none"}!function(t){t(document).ready((function(){if(t(".mdp-tab-name-open_button").length){let x=t("#mdp_readabler_open_button_settings-show_open_button");function w(){x.is(":checked")?x.closest("tr").nextAll("tr").show(300):x.closest("tr").nextAll("tr").hide(300)}x.on("change",w),w()}let n=t("#mdp-api-key-drop-zone");n.on("dragenter",(function(){l(),t(this).addClass("mdp-hover")})),n.on("dragleave",(function(){t(this).removeClass("mdp-hover")})),n.on("dragover",(function(e){e.stopPropagation(),e.preventDefault()}));let a=t("#mdp-readabler-settings-dnd-api-key");function i(e){let i=new FileReader;i.onload=function(e){let i=e.target.result;return function(e){try{JSON.parse(e)}catch(e){return!1}return!0}(i)?void 0===JSON.parse(i).private_key?(s("Error: Your API key file looks like not valid. Please make sure you use the correct key."),void n.removeClass("mdp-busy")):(a.val(btoa(i)),l(),void(a.val().length>1e3?t("#submit").click():(s("Error: Your API key file looks like not valid. Please make sure you use the correct key."),n.removeClass("mdp-busy")))):(s("Error: Uploaded file is empty or not a valid JSON file."),void n.removeClass("mdp-busy"))},i.readAsText(e)}n.on("drop",(function(e){e.stopPropagation(),e.preventDefault(),t(this).removeClass("mdp-hover"),n.addClass("mdp-busy");let a=e.originalEvent.dataTransfer.files[0];r(a)?i(a):n.removeClass("mdp-busy")}));let o=t("#mdp-dnd-file-input");function s(e){n.next().addClass("mdp-error").html(e)}function l(){n.next().removeClass("mdp-error").html("")}function r(e){return null==e?(s("Error: Failed to read file. Please try again."),!1):!!e.type.match("application/json")||(s("Error: API Key must be a valid JSON file."),!1)}n.on("click",(function(){o.click()})),o.on("change",(function(e){n.addClass("mdp-busy");let t=e.target.files[0];r(t)?i(t):n.removeClass("mdp-busy")})),t(".mdp-reset-key-btn").on("click",(function(){a.val(""),t("#submit").trigger("click")}));let d=t("#mdp-readabler-settings-language-tbl");d.removeClass("hidden"),d.DataTable({lengthMenu:[[-1],["All"]],initComplete:function(){this.api().columns().every((function(){let e=this,n=t("#mdp-readabler-language-filter");0==e[0][0]&&n.on("change",(function(){t("#mdp-readabler-settings-language-tbl tbody").show(),t("#mdp-readabler-settings-language-tbl_info").show(),t("#mdp-readabler-settings-language-tbl_paginate").hide(),t("#mdp-readabler-settings-language-tbl_length").hide(),t("#mdp-readabler-settings-language-tbl thead").show();let n=t.fn.dataTable.util.escapeRegex(t(this).val());"0"===n&&(n=""),e.search(n?"^"+n+"$":"",!0,!1).draw()}))})),t("#mdp-readabler-settings-language-tbl tbody").hide(),t("#mdp-readabler-settings-language-tbl_info").hide(),t("#mdp-readabler-settings-language-tbl_paginate").hide(),t("#mdp-readabler-settings-language-tbl_length").hide(),t("#mdp-readabler-settings-language-tbl thead").hide()}}),t("#mdp-readabler-settings-language-tbl tbody").on("click","tr",(function(e){t("#mdp-readabler-settings-language-tbl tr.selected").removeClass("selected"),t(this).addClass("selected");let n=t("#mdp-readabler-settings-language-tbl tr.selected .mdp-voice-name").attr("title"),a=t("#mdp-readabler-settings-language-tbl tr.selected .mdp-lang-code").text();t(".mdp-now-used strong").html(n),t("#mdp-readabler-settings-language").val(n),t("#mdp-readabler-settings-language-code").val(a);let i=t(".mdp-now-used audio");t(".mdp-now-used audio source:nth-child(1)").attr("src","https://cloud.google.com/text-to-speech/docs/audio/"+n+".mp3"),t(".mdp-now-used audio source:nth-child(2)").attr("src","https://cloud.google.com/text-to-speech/docs/audio/"+n+".wav"),i[0].pause(),i[0].load()}));let _=t("#mdp-readabler-language-filter").parent().data("mdc-index");d.DataTable().rows().every((function(e,n,a){let i=this.data();i[1].includes(t("#mdp-readabler-settings-language").val())&&(window.MerkulovMaterial[_].value=i[0])}));let c=t("#mdp_readabler_open_button_settings_show_open_button");function g(){!0===c.prop("checked")?c.closest("tr").next().show(300).next().show(300).next().show(300).next().show(300).next().show(300).next().show(300).next().show(300).next().show(300).next().show(300).next().show(300).next().show(300).next().show(300).next().show(300).next().show(300).next().show(300).next().show(300).next().show(300).next().show(300).next().show(300):c.closest("tr").next().hide(300).next().hide(300).next().hide(300).next().hide(300).next().hide(300).next().hide(300).next().hide(300).next().hide(300).next().hide(300).next().hide(300).next().hide(300).next().hide(300).next().hide(300).next().hide(300).next().hide(300).next().hide(300).next().hide(300).next().hide(300).next().hide(300)}c.length&&(c.on("click",g),g());let u=t("#mdp_readabler_modal_popup_settings_popup_overlay");function p(){!0===u.prop("checked")?u.closest("tr").next().show(300):u.closest("tr").next().hide(300)}u.on("click",p),p();let m=t("#mdp_readabler_text_to_speech_settings_multi");function v(){!0===m.prop("checked")?(m.closest("tr").next().show(300),m.closest("tr").next().next().show(300)):(m.closest("tr").next().hide(300),m.closest("tr").next().next().hide(300))}m.on("click",v),v();let h=t("#mdp_readabler_accessibility_statement_settings_statement_type");function b(){const e=t("#mdp_readabler_accessibility_statement_settings_statement_link");let n=200;"undefined"===window.statementType&&(n=0),window.statementType=!0,"hide"===h.val()&&h.closest("tr").nextAll("tr").hide(100),"link"===h.val()&&(e.closest("tr").nextAll("tr").hide(100),e.closest("tr").show(400)),"inline"===h.val()&&(e.closest("tr").hide(100),e.closest("tr").nextAll("tr").show(400))}function f(){const e=document.querySelector("#mdp_readabler_initial_settings_settings_start_config");if(!e)return;const n=e.querySelectorAll("option"),a=e.nextSibling;let i=[];a.querySelectorAll("li.search-choice a.search-choice-close").forEach((e=>{let t=e.getAttribute("data-option-array-index");i.push(n[t].value)})),["content_scaling","font_sizing","line_height","letter_spacing"].forEach((e=>{const n=t(`#mdp_readabler_initial_settings_settings_start_${e}`);i.includes(e)?n.closest("tr").show(200):n.closest("tr").hide(0)}))}h.on("change",b),b(),f(),document.querySelector("#mdp_readabler_initial_settings_settings_start_config")&&t("#mdp_readabler_initial_settings_settings_start_config").on("change",(function(e){setTimeout(f,1)})),document.querySelector(".mdp-tab-name-voice_navigation")&&(e("#mdp_readabler_voice_navigation_settings_voice_navigation_enable_scroll_down",2),e("#mdp_readabler_voice_navigation_settings_voice_navigation_enable_scroll_up",2),e("#mdp_readabler_voice_navigation_settings_voice_navigation_enable_scroll_right",2),e("#mdp_readabler_voice_navigation_settings_voice_navigation_enable_scroll_left",2),e("#mdp_readabler_voice_navigation_settings_voice_navigation_enable_go_to_top",1),e("#mdp_readabler_voice_navigation_settings_voice_navigation_enable_go_to_bottom",1),e("#mdp_readabler_voice_navigation_settings_voice_navigation_enable_tab",1),e("#mdp_readabler_voice_navigation_settings_voice_navigation_enable_tab_back",1),e("#mdp_readabler_voice_navigation_settings_voice_navigation_enable_show_numbers",3),e("#mdp_readabler_voice_navigation_settings_voice_navigation_enable_move_up",1),e("#mdp_readabler_voice_navigation_settings_voice_navigation_enable_move_down",1),e("#mdp_readabler_voice_navigation_settings_voice_navigation_enable_move_left",1),e("#mdp_readabler_voice_navigation_settings_voice_navigation_enable_move_right",1),e("#mdp_readabler_voice_navigation_settings_voice_navigation_enable_clear_input",1),e("#mdp_readabler_voice_navigation_settings_voice_navigation_enable_enter",1),e("#mdp_readabler_voice_navigation_settings_voice_navigation_enable_reload",1),e("#mdp_readabler_voice_navigation_settings_voice_navigation_enable_stop",1),e("#mdp_readabler_voice_navigation_settings_voice_navigation_enable_exit",1),e("#mdp_readabler_voice_navigation_settings_voice_navigation_voice_feedback",3)),function(){if(!document.querySelector(".mdp-tab-name-usage_analytics"))return;e("#mdp_readabler_usage_analytics_settings_analytics",7);const t=document.querySelector("#mdp_readabler_usage_analytics_settings_analytics_reset");t&&t.addEventListener("click",(function(e){if(e.preventDefault(),window.confirm("Do you really want to clear all analytics data?")){const{ajaxURL:e,nonce:t}=window.mdpReadablerUnity,n=new XMLHttpRequest;n.open("POST",e,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),n.send("action=readabler_reset_usage_analytics&nonce="+t),n.onload=function(){const e=JSON.parse(n.responseText);e.success?alert("Analytics data cleared."):e.data&&(alert(e.data),console.warn(e.data))}}}),!1)}()}))}(jQuery)})();