"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}();(function(){var e,t,i,a,n=[].indexOf;jQuery.fn.extend({imagepicker:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.each(function(){var i;if((i=jQuery(this)).data("picker")&&i.data("picker").destroy(),i.data("picker",new e(this,a(t))),null!=t.initialized)return t.initialized.call(i.data("picker"))})}}),a=function(e){var t;return t={hide_select:!0,show_label:!1,initialized:void 0,changed:void 0,clicked:void 0,selected:void 0,limit:void 0,limit_reached:void 0,font_awesome:!1},jQuery.extend(t,e)},i=function(e,t){var i,a,n,r;if(!e||!t||e.length!==t.length)return!1;for(e=e.slice(0),t=t.slice(0),e.sort(),t.sort(),i=a=0,n=e.length;a<n;i=++a)if(r=e[i],t[i]!==r)return!1;return!0},e=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,e),this.sync_picker_with_select=this.sync_picker_with_select.bind(this),this.opts=i,this.select=jQuery(t),this.multiple="multiple"===this.select.attr("multiple"),null!=this.select.data("limit")&&(this.opts.limit=parseInt(this.select.data("limit"))),this.build_and_append_picker()}return _createClass(e,[{key:"destroy",value:function(){var e,t,i;for(e=0,t=(i=this.picker_options).length;e<t;e++)i[e].destroy();return this.picker.remove(),this.select.off("change",this.sync_picker_with_select),this.select.removeData("picker"),this.select.show()}},{key:"build_and_append_picker",value:function(){return this.opts.hide_select&&this.select.hide(),this.select.on("change",this.sync_picker_with_select),null!=this.picker&&this.picker.remove(),this.create_picker(),this.select.after(this.picker),this.sync_picker_with_select()}},{key:"sync_picker_with_select",value:function(){var e,t,i,a,n;for(n=[],e=0,t=(a=this.picker_options).length;e<t;e++)(i=a[e]).is_selected()?n.push(i.mark_as_selected()):n.push(i.unmark_as_selected());return n}},{key:"create_picker",value:function(){return this.picker=jQuery("<ul class='thumbnails image_picker_selector'></ul>"),this.picker_options=[],this.recursively_parse_option_groups(this.select,this.picker),this.picker}},{key:"recursively_parse_option_groups",value:function(e,i){var a,n,r,l,s,o,d,c,u,v;for(n=0,l=(c=e.children("optgroup")).length;n<l;n++)d=c[n],d=jQuery(d),(a=jQuery("<ul></ul>")).append(jQuery("<li class='group_title'>"+d.attr("label")+"</li>")),i.append(jQuery("<li class='group'>").append(a)),this.recursively_parse_option_groups(d,a);for(u=function(){var i,a,n,r;for(r=[],i=0,a=(n=e.children("option")).length;i<a;i++)o=n[i],r.push(new t(o,this,this.opts));return r}.call(this),v=[],r=0,s=u.length;r<s;r++)o=u[r],this.picker_options.push(o),o.has_image()&&v.push(i.append(o.node));return v}},{key:"has_implicit_blanks",value:function(){var e;return function(){var t,i,a,n;for(n=[],t=0,i=(a=this.picker_options).length;t<i;t++)(e=a[t]).is_blank()&&!e.has_image()&&n.push(e);return n}.call(this).length>0}},{key:"selected_values",value:function(){return this.multiple?this.select.val()||[]:[this.select.val()]}},{key:"toggle",value:function(e,t){var a,r,l;if(r=this.selected_values(),l=e.value().toString(),this.multiple?n.call(this.selected_values(),l)>=0?((a=this.selected_values()).splice(jQuery.inArray(l,r),1),this.select.val([]),this.select.val(a)):null!=this.opts.limit&&this.selected_values().length>=this.opts.limit?null!=this.opts.limit_reached&&this.opts.limit_reached.call(this.select):this.select.val(this.selected_values().concat(l)):this.has_implicit_blanks()&&e.is_selected()?this.select.val(""):this.select.val(l),!i(r,this.selected_values())&&(this.select.change(),null!=this.opts.changed))return this.opts.changed.call(this.select,r,this.selected_values(),t)}}]),e}(),t=function(){function e(t,i){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};_classCallCheck(this,e),this.clicked=this.clicked.bind(this),this.picker=i,this.opts=a,this.option=jQuery(t),this.create_node()}return _createClass(e,[{key:"destroy",value:function(){return this.node.find(".thumbnail").off("click",this.clicked)}},{key:"has_image",value:function(){return null!=this.option.data("img-src")}},{key:"is_blank",value:function(){return!(null!=this.value()&&""!==this.value())}},{key:"is_selected",value:function(){var e;return e=this.picker.select.val(),this.picker.multiple?jQuery.inArray(this.value(),e)>=0:this.value()===e}},{key:"mark_as_selected",value:function(){return this.node.find(".thumbnail").addClass("selected")}},{key:"unmark_as_selected",value:function(){return this.node.find(".thumbnail").removeClass("selected")}},{key:"value",value:function(){return this.option.val()}},{key:"label",value:function(){return this.option.data("img-label")?this.option.data("img-label"):this.option.text()}},{key:"clicked",value:function(e){if(this.picker.toggle(this,e),null!=this.opts.clicked&&this.opts.clicked.call(this.picker.select,this,e),null!=this.opts.selected&&this.is_selected())return this.opts.selected.call(this.picker.select,this,e)}},{key:"create_node",value:function(){var e,t,i,a;return this.node=jQuery("<li/>"),this.option.data("font_awesome")?(e=jQuery("<i>")).attr("class","fa-fw "+this.option.data("img-src")):(e=jQuery("<img class='image_picker_image'/>")).attr("src",this.option.data("img-src")),a=jQuery("<div class='thumbnail'>"),(i=this.option.data("img-class"))&&(this.node.addClass(i),e.addClass(i),a.addClass(i)),(t=this.option.data("img-alt"))&&e.attr("alt",t),a.on("click",this.clicked),a.append(e),this.opts.show_label&&a.append(jQuery("<p/>").html(this.label())),this.node.append(a),this.node}}]),e}()}).call(void 0),jQuery(document).ready(function(e){e('select[name="_envira_gallery[image_size]"]').on("change",function(){"envira_gallery_random"===e(this).val()?e("tr#envira-config-image-sizes-random-box").show():e("tr#envira-config-image-sizes-random-box").hide()}),e('select[name="_envira_gallery[image_size]"]').trigger("change"),e("#envira-gallery.postbox").on("dragstart",function(e){return!1})}),function(e){e(function(){var t=!1;"default"===e('input[name="_envira_gallery[type]"]:checked').val()?e("#envira-gallery-preview").hide():e("#envira-gallery-preview").show(),e(document).on("enviraGalleryType enviraGalleryPreview",function(){var i=e('input[name="_envira_gallery[type]"]:checked').val(),a=e("#envira-gallery-preview .spinner"),n=e("#envira-gallery-preview-main");"default"!==i?t||(t=!0,e(n).html(""),e.ajax({type:"post",url:envira_gallery_metabox.ajax,dataType:"json",data:{action:"envira_gallery_change_preview",post_id:envira_gallery_metabox.id,type:i,data:e("form#post").serializeArray(),nonce:envira_gallery_metabox.preview_nonce},success:function(i){e(n).html(i),e(a).hide(),t=!1},error:function(i,r){e(n).html('<div class="error"><p>'+i.responseText+"</p></div>"),e(a).hide(),t=!1}})):e(n).hide()})})}(jQuery),function(e){e(function(){e("#envira-gallery-types-nav").on("click","li",function(t){e('input[name="_envira_gallery[type]"]',e(this)).prop("checked",!0).trigger("change")}),e(document).on("change",'input[name="_envira_gallery[type]"]:radio',function(t){var i=e(this).val(),a=e("#envira-tabs #envira-tab-images .spinner"),n=e("#envira-tabs #envira-tab-images #envira-gallery-main");e(a).css("visibility","visible"),e("li",e(this).closest("#envira-gallery-types-nav")).removeClass("envira-active"),e(this).closest("li").addClass("envira-active"),e("a",e("#envira-tabs-nav li").first()).trigger("click"),e(n).html(""),e.ajax({type:"post",url:envira_gallery_metabox.ajax,dataType:"json",data:{action:"envira_gallery_change_type",post_id:envira_gallery_metabox.id,type:i,nonce:envira_gallery_metabox.change_nonce},success:function(t){e(n).html(t.html),e(document).trigger("enviraGalleryType",t),e(a).hide()},error:function(t,i){e(n).html('<div class="error"><p>'+t.responseText+"</p></div>"),e(a).hide()}})})})}(jQuery);var envira_video_link="p.envira-intro a.envira-video",envira_close_video_link="a.envira-video-close";jQuery(document).ready(function(e){e(document).on("click",envira_video_link,function(t){t.preventDefault();var i=e(this).attr("href");e("div.envira-video-help").remove();var a=e(this).closest("p.envira-intro");e(a).append('<div class="envira-video-help"><iframe src="'+i+'" /><a href="#" class="envira-video-close dashicons dashicons-no"></a></div>')}),e(document).on("click",envira_close_video_link,function(t){t.preventDefault(),e(this).closest(".envira-video-help").remove()})});var EnviraGalleryBulkEditImageView=wp.Backbone.View.extend({tagName:"li",className:"attachment",template:wp.template("envira-meta-bulk-editor-image"),initialize:function(e){this.model=e.model},render:function(){return this.$el.html(this.template(this.model.attributes)),this}}),EnviraGalleryBulkEditView=wp.Backbone.View.extend({tagName:"div",className:"edit-attachment-frame mode-select hide-menu hide-router",template:wp.template("envira-meta-bulk-editor"),events:{"keyup input":"updateItem","keyup textarea":"updateItem","change input":"updateItem","change textarea":"updateItem","blur textarea":"updateItem","change select":"updateItem","click .actions a.envira-gallery-meta-submit":"saveItem","keyup input#link-search":"searchLinks","click div.query-results li":"insertLink","click button.media-file":"insertMediaFileLink","click button.attachment-page":"insertAttachmentPageLink"},initialize:function(e){this.on("loading",this.loading,this),this.on("loaded",this.loaded,this),this.is_loading=!1,this.collection=e.collection,this.child_views=e.child_views,this.model=new EnviraGalleryImage},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.collection.forEach(function(e){var t=new EnviraGalleryBulkEditImageView({model:e});this.$el.find("ul.attachments").append(t.render().el)},this),this.child_views.length>0&&this.child_views.forEach(function(e){var t=new e({model:this.model});this.$el.find("div.envira-addons").append(t.render().el)},this),setTimeout(function(){quicktags({id:"caption",buttons:"strong,em,link,ul,ol,li,close"}),QTags._buttonsInit()},500),this.model.set("status","active"),wpLink.init,this},renderError:function(e){var t={};return t.error=e,new wp.media.view.EnviraGalleryError({model:t}).render().el},loading:function(){this.is_loading=!0,this.$el.find(".spinner").css("visibility","visible")},loaded:function(e){this.is_loading=!1,this.$el.find(".spinner").css("visibility","hidden"),void 0!==e&&this.$el.find("ul.attachments").before(this.renderError(e))},updateItem:function(e){let t;""!==e.target.name&&(t="checkbox"===e.target.type?e.target.checked?1:0:e.target.value,this.model.set(e.target.name,t))},saveItem:function(e){let t;e.preventDefault(),this.trigger("loading");var i=[];this.collection.forEach(function(e){i.push(e.id)},this),wp.media.ajax("envira_gallery_save_bulk_meta",{context:this,data:{nonce:envira_gallery_metabox.save_nonce,post_id:envira_gallery_metabox.id,meta:this.model.attributes,image_ids:i},success:function(e){this.collection.forEach(function(i){for(var a in this.model.attributes)(t=this.model.attributes[a]).length>0&&("tags"==a?i.set(a,e[i.get("id")]):i.set(a,t));var n=JSON.stringify(i.attributes),r=jQuery("ul#envira-gallery-output li#"+i.get("id")+" .envira-item-status"),l=(r.data("status"),r.hasClass("list-status"),r.parent()),s=l.find(".envira-item-status.list-status"),o=l.find(".envira-item-status.grid-status"),d=(r.data("id"),o.find("span.dashicons")),c=s.find("span"),u=i.get("status");jQuery("ul#envira-gallery-output li#"+i.get("id")).attr("data-envira-gallery-image-model",n),jQuery("ul#envira-gallery-output li#"+i.get("id")+" div.title").text(i.get("title")),"active"===u?(o.removeClass("envira-draft-item").addClass("envira-active-item"),s.removeClass("envira-draft-item").addClass("envira-active-item"),d.removeClass("dashicons-hidden").addClass("dashicons-visibility"),c.text(envira_gallery_metabox.active),o.attr("data-envira-tooltip",envira_gallery_metabox.active),s.data("status","active"),o.data("status","active")):(o.removeClass("envira-active-item").addClass("envira-draft-item"),s.removeClass("envira-active-item").addClass("envira-draft-item"),d.removeClass("dashicons-visibility").addClass("dashicons-hidden"),c.text(envira_gallery_metabox.draft),s.data("status","pending"),o.data("status","pending"),o.attr("data-envira-tooltip",envira_gallery_metabox.draft))},this),jQuery("nav.envira-tab-options input[type=checkbox]").prop("checked",!1).trigger("change"),this.trigger("loaded loaded:success"),EnviraGalleryModalWindow.close()},error:function(e){this.trigger("loaded loaded:error",e)}})},insertMediaFileLink:function(e){this.trigger("loading"),this.model.set("link",response.media_link),this.trigger("loaded loaded:success"),this.render()},insertAttachmentPageLink:function(e){this.trigger("loading"),this.model.set("link",response.media_link),this.trigger("loaded loaded:success"),this.render()}});jQuery(document).ready(function(e){e("#envira-gallery-main").on("click","a.envira-gallery-images-edit",function(e){e.preventDefault(),EnviraGalleryImagesUpdate(!0),EnviraGalleryModalWindow.content(new EnviraGalleryBulkEditView({collection:EnviraGalleryImages,child_views:EnviraGalleryChildViews})),EnviraGalleryModalWindow.open()})});var EnviraGalleryImage=Backbone.Model.extend({defaults:{id:"",title:"",caption:"",alt:"",link:""}}),EnviraGalleryImages=new Backbone.Collection;if(void 0===EnviraGalleryModalWindow)var EnviraGalleryModalWindow=new wp.media.view.Modal({controller:{trigger:function(){}}});var EnviraGalleryEditView=wp.Backbone.View.extend({tagName:"div",className:"edit-attachment-frame mode-select hide-menu hide-router",template:wp.template("envira-meta-editor"),events:{"click .edit-media-header .left":"loadPreviousItem","click .edit-media-header .right":"loadNextItem","keyup input":"updateItem","keyup textarea":"updateItem","change input":"updateItem","change textarea":"updateItem","blur textarea":"updateItem","change select":"updateItem","click .actions a.envira-gallery-meta-submit":"saveItem","keyup input#link-search":"searchLinks","click div.query-results li":"insertLink","click button.media-file":"insertMediaFileLink","click button.attachment-page":"insertAttachmentPageLink"},initialize:function(e){this.on("loading",this.loading,this),this.on("loaded",this.loaded,this),this.is_loading=!1,this.collection=e.collection,this.child_views=e.child_views,this.attachment_id=e.attachment_id,this.attachment_index=0,this.search_timer="";var t=0;this.collection.each(function(e){if(e.get("id")==this.attachment_id)return this.model=e,this.attachment_index=t,!1;t++},this)},render:function(){return this.$el.html(this.template(this.model.attributes)),this.child_views.length>0&&this.child_views.forEach(function(e){var t=new e({model:this.model});this.$el.find("div.envira-addons").append(t.render().el)},this),this.$el.find("textarea[name=caption]").val(this.model.get("caption")),setTimeout(function(){quicktags({id:"caption",buttons:"strong,em,link,ul,ol,li,close"}),QTags._buttonsInit()},500),wpLink.init,0==this.attachment_index&&this.$el.find("button.left").addClass("disabled"),this.attachment_index==this.collection.length-1&&this.$el.find("button.right").addClass("disabled"),jQuery(document).trigger("enviraRenderMeta"),this},renderError:function(e){var t={};return t.error=e,new wp.media.view.EnviraGalleryError({model:t}).render().el},loading:function(){this.is_loading=!0,this.$el.find(".spinner").css("visibility","visible")},loaded:function(e){this.is_loading=!1,this.$el.find(".spinner").css("visibility","hidden"),void 0!==e&&this.$el.find("div.media-toolbar").after(this.renderError(e))},loadPreviousItem:function(e){this.saveItem(e),this.updateItem(e),this.attachment_index--,this.model=this.collection.at(this.attachment_index),this.attachment_id=this.model.get("id"),this.render()},loadNextItem:function(e){this.saveItem(e),this.updateItem(e),this.attachment_index++,this.model=this.collection.at(this.attachment_index),this.attachment_id=this.model.get("id"),this.render()},updateItem:function(e){let t;""!=e.target.name&&(t="checkbox"==e.target.type?e.target.checked?e.target.value:0:e.target.value,this.model.set(e.target.name,t))},saveItem:function(e){var t=jQuery("#envira-metabox-saving-error");0!==t.length&&t.hide(),e.preventDefault();var i=this;this.trigger("loading"),wp.media.ajax("envira_gallery_save_meta",{context:this,data:{nonce:envira_gallery_metabox.save_nonce,post_id:envira_gallery_metabox.id,attach_id:this.model.get("id"),meta:this.model.attributes},success:function(e){i.trigger("loaded loaded:success");var t=JSON.stringify(i.model.attributes),a=jQuery("ul#envira-gallery-output li#"+i.model.get("id"));jQuery(a).attr("data-envira-gallery-image-model",t),jQuery("div.meta div.title span",a).text(i.model.get("title")),jQuery("div.meta div.title a.hint",a).attr("title",i.model.get("title")),i.model.get("title").length>20?jQuery("div.meta div.title a.hint",a).removeClass("hidden"):jQuery("div.meta div.title a.hint",a).addClass("hidden");var n=i.$el.find(".saved");n.fadeIn(),setTimeout(function(){n.fadeOut()},1500)},error:function(e){if(i.trigger("loaded loaded:error",e),0===t.length){var a=this.$el.find(".saved");jQuery(a).after(`<span id='envira-metabox-saving-error' style='color: red'>${e}</span>`)}else t.show(),t.html(e)}})},searchLinks:function(e){},insertLink:function(e){},insertMediaFileLink:function(e){this.trigger("loading"),wp.media.ajax("envira_gallery_get_attachment_links",{context:this,data:{nonce:envira_gallery_metabox.save_nonce,attachment_id:this.model.get("id")},success:function(e){this.model.set("link",e.media_link),this.trigger("loaded loaded:success"),this.render()},error:function(e){this.trigger("loaded loaded:error",e)}})},insertAttachmentPageLink:function(e){this.trigger("loading"),wp.media.ajax("envira_gallery_get_attachment_links",{context:this,data:{nonce:envira_gallery_metabox.save_nonce,attachment_id:this.model.get("id")},success:function(e){this.model.set("link",e.attachment_page),this.trigger("loaded loaded:success"),this.render()},error:function(e){this.trigger("loaded loaded:error",e)}})}}),EnviraGalleryChildViews=[];function EnviraGalleryImagesUpdate(e){EnviraGalleryImages.reset();var t="";jQuery("ul#envira-gallery-output li.envira-gallery-image"+(e?".selected":"")).each(function(){t=(t=jQuery(this).attr("data-envira-gallery-image-model")).replace(/(\r\n|\n|\r)/gm,"");var e=jQuery.parseJSON(t);e.alt=EnviraGalleryStripslashes(e.alt),EnviraGalleryImages.add(new EnviraGalleryImage(e))})}function EnviraGalleryStripslashes(e){return(e+"").replace(/\\(.?)/g,function(e,t){switch(t){case"\\":return"\\";case"0":return"\0";case"":return"";default:return t}})}jQuery(document).ready(function(e){e("a.envira-media-library").on("click",function(t){t.preventDefault(),wp.media.frames.envira?wp.media.frames.envira.open():(wp.media.frames.envira=wp.media({frame:"post",title:wp.media.view.l10n.insertIntoPost,library:{type:["image"]},button:{text:wp.media.view.l10n.insertIntoPost},multiple:!0}),wp.media.frames.envira.on("open",function(){var t=wp.media.frames.envira.state().get("selection");e("ul#envira-gallery-output li").each(function(){var i=wp.media.attachment(e(this).attr("id"));void 0!=t&&t.add(i?[i]:[])})}),wp.media.frames.envira.on("insert",function(t){var i=wp.media.frames.envira.state(),a=[];t.each(function(e){var t=i.display(e).toJSON();switch(t.link){case"none":case"file":e.set("link",e.get("url"));break;case"post":break;case"custom":e.set("link",t.linkUrl)}a.push(e.toJSON())},this),e(document).find(".envira-progress-adding-images").css("display","block"),e.post(envira_gallery_metabox.ajax,{action:"envira_gallery_insert_images",nonce:envira_gallery_metabox.insert_nonce,post_id:envira_gallery_metabox.id,order:e("#envira-config-image-sort").val(),direction:e("#envira-config-image-sort-dir").val(),images:JSON.stringify(a)},function(t){t&&t.success&&(e("#envira-gallery-output").html(t.success),e(document).trigger("enviraInsert"),EnviraGalleryImagesUpdate(!1),e(document).find(".envira-progress-adding-images").css("display","none"))},"json")}),wp.media.frames.envira.open(),e("div.media-menu #menu-item-gallery").css("display","none"),e("div.media-menu a.media-menu-item:nth-child(4)").addClass("hidden"),e("div.media-menu #menu-item-playlist").css("display","none"),e("div.media-menu #menu-item-video-playlist").css("display","none"),e("div.media-menu #menu-item-featured-image").css("display","none"))})});var envira_manage=window.envira_manage||{};!function(e,t,i,a,n){var r="#envira-gallery-output",l=e(r+" li").length,s=!1,o=!1;t.envira_manage=a={init:function(){this.select(),this.select_all(),this.clear_selected(),this.image_select(),this.sortable(),this.sort_images(),this.display_toggle(),this.delete_item(),this.bulk_delete(),this.edit_meta(),this.toggle_status(),this.tooltip(),e(i).on("keyup keydown",function(e){s=e.shiftKey}),this.image_filter(),e(i).trigger("envriaAdminInit")},image_select:function(){e("#envira-config-layouts").imagepicker({show_label:!0})},image_filter:function(){e("#envira-filter-images").on("keyup",function(){var t=e(this).val(),i=e(".envira-gallery-image"),a="";""!=t?i.each(function(i){e(this).find(".title").text().search(t)>-1?e(this).show().fadeIn(1e3):(e(this).hide().fadeOut(1e3),e(this).removeClass("selected"),a=e(r+" li.selected").length,o=!1,0!==a?(e(".select-all").text(n.selected),e(".envira-count").text(a.toString()),e(".envira-clear-selected").fadeIn()):(l=e(r+" li").length,e(".select-all").text(n.select_all),e(".envira-count").text(l.toString()),e(".envira-clear-selected").fadeOut(),e(".select-all").text(n.select_all),e(".envira-count").text(l.toString()),e(".envira-clear-selected").fadeOut()))}):i.show()})},toggle_status:function(){e(r).on("click.enviraStatus",".envira-item-status",function(t){t.preventDefault(),t.stopPropagation();var a=e(this),r=a.data("status"),l=a.hasClass("list-status")?a.parent().parent().parent():a.parent(),s=l.find(".envira-item-status.list-status"),o=l.find(".envira-item-status.grid-status"),d=a.data("id"),c=o.find("span.dashicons"),u=s.find("span"),v="active"===r?"pending":"active",h={url:n.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"envira_change_image_status",post_id:n.id,gallery_id:d,status:v,nonce:n.save_nonce},success:function(t){t.success&&("active"===v?(o.removeClass("envira-draft-item").addClass("envira-active-item"),s.removeClass("envira-draft-item").addClass("envira-active-item"),c.removeClass("dashicons-hidden").addClass("dashicons-visibility"),u.text(n.active),o.attr("data-envira-tooltip",n.active),s.data("status","active"),o.data("status","active")):(o.removeClass("envira-active-item").addClass("envira-draft-item"),s.removeClass("envira-active-item").addClass("envira-draft-item"),c.removeClass("dashicons-visibility").addClass("dashicons-hidden"),u.text(n.draft),s.data("status","pending"),o.data("status","pending"),o.attr("data-envira-tooltip",n.draft)),e(i).trigger("envriaChangeStatus "))},error:function(e,t,i){}};e.ajax(h)})},tooltip:function(){e("[data-envira-tooltip]").on("mouseover",function(t){t.preventDefault();e(this).data("envira-tooltip")})},select_all:function(){e(i).on("change","nav.envira-tab-options input",function(t){if(e(this).prop("checked")){e("li",e(r)).addClass("selected"),e("nav.envira-select-options").fadeIn();var a=e(r+" li.selected").length;e(".select-all").text(n.selected),e(".envira-count").text(a.toString()),e(".envira-clear-selected").fadeIn()}else e("li",e(r)).removeClass("selected"),e("nav.envira-select-options").fadeOut(),l=e(r+" li").length,e(".select-all").text(n.select_all),e(".envira-count").text(l.toString()),e(".envira-clear-selected").fadeOut();e(i).trigger("enviraSelectAll")})},sort_images:function(){e(i).on("change","#envira-config-image-sort, #envira-config-image-sort-dir",function(){e(this);var t=e("#envira-config-image-sort").val(),i=e("#envira-config-image-sort-dir").val(),l={url:n.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"envira_sort_publish",post_id:n.id,order:t,direction:i,nonce:n.save_nonce},success:function(i){i&&(e(r).html(i.data),EnviraGalleryImagesUpdate(!1),"manual"===t||"0"==t?e(r).attr("data-sortable","1"):e(r).attr("data-sortable","0"),a.sortable())},error:function(e,t,i){}};e.ajax(l)})},sortable:function(){"1"===e(r).attr("data-sortable")?(e(r).hasClass("ui-sortable")&&e(r).sortable("enable"),e(r).sortable({containment:r,items:"li",cursor:"move",forcePlaceholderSize:!0,placeholder:"dropzone",helper:function(t,i){i.hasClass("selected")||i.addClass("selected").siblings().removeClass("selected");var a=i.parent().children(".selected").clone();return i.data("multidrag",a).siblings(".selected").remove(),e("<li/>").append(a)},stop:function(t,i){var a=i.item.data("multidrag");i.item.after(a).remove(),e.ajax({url:n.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"envira_gallery_sort_images",order:e(r).sortable("toArray").toString(),post_id:n.id,nonce:n.sort},success:function(e){EnviraGalleryImagesUpdate(!1)},error:function(t,i,a){e(r).before('<div class="error"><p>'+i.responseText+"</p></div>")}})}})):e(r).hasClass("ui-sortable")&&e(r).sortable("disable")},select:function(){e(i).on("click","ul#envira-gallery-output li.envira-gallery-image > img, li.envira-gallery-image > div, li.envira-gallery-image > a.check",function(t){t.preventDefault();var i=e(this).parent(),a="";if(i.hasClass("selected"))i.removeClass("selected"),a=e(r+" li.selected").length,o=!1,0!==a?(e(".select-all").text(n.selected),e(".envira-count").text(a.toString()),e(".envira-clear-selected").fadeIn()):(l=e(r+" li").length,e(".select-all").text(n.select_all),e(".envira-count").text(l.toString()),e(".envira-clear-selected").fadeOut());else{if(s&&!1!==o){var d=e("ul#envira-gallery-output li").index(e(o)),c=e("ul#envira-gallery-output li").index(e(i)),u=0;if(d<c)for(u=d;u<=c;u++)e("ul#envira-gallery-output li:eq( "+u+")").addClass("selected");else for(u=c;u<=d;u++)e("ul#envira-gallery-output li:eq( "+u+")").addClass("selected")}e(i).addClass("selected"),o=e(i),a=e(r+" li.selected").length,e(".envira-clear-selected").fadeIn(),e(".select-all").text(n.selected),e(".envira-count").text(a.toString())}e("ul#envira-gallery-output > li.selected").length>0?e("nav.envira-select-options").fadeIn():e("nav.envira-select-options").fadeOut()})},clear_selected:function(){e(".envira-clear-selected").on("click",function(t){t.preventDefault(),e(r+" li.selected").removeClass("selected"),l=e(r+" li").length,e(".select-all").text(n.select_all),e(".envira-count").text(l.toString()),e(".envira-select-all").prop("checked",!1),e("nav.envira-select-options").fadeOut(),e(this).fadeOut(),e(i).trigger("enviraClearSelected")})},display_toggle:function(){e(i).on("click","nav.envira-tab-options a",function(t){t.preventDefault();var a=e(this).closest(".envira-tab-options"),r=e(this).data("view"),l=e(this).data("view-style");e(r).hasClass(l)||(e(r).removeClass("list").removeClass("grid").addClass(l),e("a",a).removeClass("selected"),e(this).addClass("selected"),e.ajax({url:n.ajax,type:"post",dataType:"json",data:{action:"envira_gallery_set_user_setting",name:"envira_gallery_image_view",value:l,nonce:n.set_user_setting_nonce},success:function(t){e(i).trigger("enviraDisplayToggle")},error:function(t,i,a){e(envira_gallery_output).before('<div class="error"><p>'+i.responseText+"</p></div>")}}))})},chosen:function(){e(".envira-chosen").each(function(){alert("b");var t=e(this).data("envira-chosen-options");e(this).chosen(t)})},update_count:function(){l=e(r+" li").length,e(".envira-count").text(l.toString()),l>0&&(e("#envira-empty-itemr").fadeOut().addClass("envira-hidden"),e(".envira-item-header").removeClass("envira-hidden").fadeIn(),e(".envira-bulk-actions").fadeOut())},delete_item:function(){e(i).on("click","#envira-gallery-main .envira-gallery-remove-image",function(t){if(t.preventDefault(),confirm(n.remove)){var i=e(this).parent().attr("id");e.ajax({url:n.ajax,type:"post",dataType:"json",data:{action:"envira_gallery_remove_image",attachment_id:i,post_id:n.id,nonce:n.remove_nonce},success:function(t){e("#"+i).fadeOut("normal",function(){e(this).remove(),e(".envira-gallery-load-library").attr("data-envira-gallery-offset",0).addClass("has-search").trigger("click"),EnviraGalleryImagesUpdate(!1),a.update_count(),a.start_screen()})},error:function(t,i,a){e(envira_gallery_output).before('<div class="error"><p>'+i.responseText+"</p></div>")}})}})},bulk_delete:function(){e(i).on("click","a.envira-gallery-images-delete",function(t){if(t.preventDefault(),!confirm(n.remove_multiple))return!1;var i=[];e("ul#envira-gallery-output > li.selected").each(function(){i.push(e(this).attr("id"))}),e.ajax({url:n.ajax,type:"post",dataType:"json",data:{action:"envira_gallery_remove_images",attachment_ids:i,post_id:n.id,nonce:n.remove_nonce},success:function(t){t&&(e(r+" > li.selected").remove(),e("nav.envira-select-options").fadeOut(),e(".envira-gallery-load-library").attr("data-envira-gallery-offset",0).addClass("has-search").trigger("click"),EnviraGalleryImagesUpdate(!1),a.update_count(),a.start_screen(),e(".envira-select-all").prop("checked",!1))},error:function(t,i,a){e(envira_gallery_output).before('<div class="error"><p>'+i.responseText+"</p></div>")}})})},edit_meta:function(){e(i).on("click","#envira-gallery-main a.envira-gallery-modify-image",function(t){t.preventDefault(),EnviraGalleryImagesUpdate(!1);var a=e(this).parent().data("envira-gallery-image");EnviraGalleryModalWindow.content(new EnviraGalleryEditView({collection:EnviraGalleryImages,child_views:EnviraGalleryChildViews,attachment_id:a})),EnviraGalleryModalWindow.open(),e(i).trigger("enviraEditOpen")})},start_screen:function(){0===(l=e(r+" li").length)?(e("nav.envira-select-options").fadeOut(),e(".envira-content-images").fadeOut().addClass("envira-hidden"),e("#envira-empty-gallery").removeClass("envira-hidden").fadeIn()):(e("#envira-empty-gallery").fadeOut().addClass("envira-hidden"),e(".envira-content-images").removeClass("envira-hidden").fadeIn())},update_selection:function(){}},e(function(){a.init()}),e(i).on("enviraGalleryType",function(){a.init()}),e(i).on("enviraInsert",function(){a.start_screen(),a.update_count()})}(jQuery,window,document,envira_manage,envira_gallery_metabox),jQuery(document).ready(function(e){e("#envira-gallery-main").on("click","a.envira-gallery-images-move",function(t){t.preventDefault();var i=e(this).data("action");EnviraGalleryModalWindow.content(new EnviraGallerySelectionView({action:i,multiple:!1,sidebar_view:"envira-meta-move-media-sidebar",modal_title:envira_gallery_metabox.move_media_modal_title,insert_button_label:envira_gallery_metabox.move_media_insert_button_label,onInsert:function(){EnviraGalleryImagesUpdate(!0);var t=[];EnviraGalleryImages.forEach(function(e){t.push(e.get("id"))}),this.selection.forEach(function(a){wp.media.ajax("envira_"+i+"_move_media",{context:this,data:{nonce:envira_gallery_metabox.move_media_nonce,from_gallery_id:envira_gallery_metabox.id,to_gallery_id:a.id,image_ids:t},success:function(t){e("ul#envira-gallery-output > li.selected").remove(),e("nav.envira-select-options").fadeOut(),EnviraGalleryImagesUpdate(!1),EnviraGalleryModalWindow.close()},error:function(e){alert(e)}})})}})),EnviraGalleryModalWindow.open()})}),function(e){e(function(){if("undefined"!=typeof uploader){e("input#plupload-browse-button").val(envira_gallery_metabox.uploader_files_computer);var t=e("#envira-gallery .envira-progress-bar"),i=e("#envira-gallery .envira-progress-bar div.envira-progress-bar-inner"),a=e("#envira-gallery .envira-progress-bar div.envira-progress-bar-status"),n=e("#envira-gallery-output"),r=e("#envira-gallery-upload-error"),l=0;uploader.bind("Init",function(t){e("#drag-drop-area").fadeIn(),e("a.envira-media-library.button").fadeIn()}),uploader.bind("FilesAdded",function(i,n){e(r).html(""),l=n.length,e(".uploading .current",e(a)).text("1"),e(".uploading .total",e(a)).text(l),e(".uploading",e(a)).show(),e(".done",e(a)).hide(),n[0].name.includes(".zip")&&e(".uploading").hide(),e(t).fadeIn("fast",function(){e("p.max-upload-size").css("padding-top","10px")})}),uploader.bind("UploadProgress",function(t,n){n.name.includes(".zip")?(e(".uploading").hide(),e(".opening_zip",e(a)).show()):e(".uploading .current",e(a)).text(l-t.total.queued+1),e(i).css({width:t.total.percent+"%"})}),uploader.bind("FileUploaded",function(i,r,s){r.name.includes(".zip")?(e(".uploading").hide(),e(".done").hide(),e(".uploading_zip").hide(),e(".envira_bar").show(),e(".envira_status").show(),e(".opening_zip").show()):e(".uploading .current",e(a)).text(l-i.total.queued+1),e.post(envira_gallery_metabox.ajax,{action:"envira_gallery_load_image",nonce:envira_gallery_metabox.load_image,id:s.response,post_id:envira_gallery_metabox.id},function(i){switch(envira_gallery_metabox.media_position){case"before":e(n).prepend(i);break;case"after":default:e(n).append(i)}e(document).trigger("enviraInsert"),EnviraGalleryImagesUpdate(!1),r.name.includes(".zip")&&(e(".opening_zip").hide(),e(".uploading_zip").hide(),e(".done_zip",e(a)).show(),setTimeout(function(){e(t).fadeOut(),e(".done_zip",e(a)).hide(),e("p.max-upload-size").css("padding-top","0")},8e3))},"json")}),uploader.bind("UploadComplete",function(i,n){if(n[n.length-1].name.includes(".zip"))return e(".done").hide(),void e(".uploading_zip",e(a)).hide();e(".uploading",e(a)).hide(),e(".done",e(a)).show(),null!==wp.media.frame.content.get()?(wp.media.frame.content.get().collection.props.set({ignore:+new Date}),wp.media.frame.content.get().options.selection.reset()):wp.media.frame.library.props.set({ignore:+new Date}),setTimeout(function(){e(t).fadeOut("fast",function(){e("p.max-upload-size").css("padding-top","0")})},1e3)}),uploader.bind("Error",function(t,i){e("#envira-gallery-upload-error").html('<div class="error fade"><p>'+i.file.name+": "+i.message+"</p></div>"),t.refresh()})}})}(jQuery);